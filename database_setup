DROP DATABASE IF EXISTS informatica_superior;
CREATE DATABASE informatica_superior;
USE informatica_superior;


CREATE TABLE usuarios (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    nombre_completo VARCHAR(100) NOT NULL,
    rol ENUM('estudiante', 'administrador') NOT NULL DEFAULT 'estudiante'
);

CREATE TABLE cursos (
    id_curso INT AUTO_INCREMENT PRIMARY KEY,
    nombre_curso VARCHAR(255) NOT NULL
);


CREATE TABLE actividades (
    id_actividad INT AUTO_INCREMENT PRIMARY KEY,
    id_curso INT NOT NULL,
    nombre_actividad VARCHAR(255) NOT NULL,
    tipo ENUM('seccion', 'actividad', 'video', 'recurso') NOT NULL,
    FOREIGN KEY (id_curso) REFERENCES cursos(id_curso)
    ON DELETE CASCADE
);

CREATE TABLE inscripciones (
    id_usuario INT NOT NULL,
    id_curso INT NOT NULL,
    progreso INT DEFAULT 0, -- Progreso en porcentaje (0-100)
    PRIMARY KEY (id_usuario, id_curso),
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE,
    FOREIGN KEY (id_curso) REFERENCES cursos(id_curso) ON DELETE CASCADE
);


CREATE TABLE progreso_actividades (
    id_usuario INT NOT NULL,
    id_actividad INT NOT NULL,
    completado BOOLEAN DEFAULT FALSE,
    PRIMARY KEY (id_usuario, id_actividad),
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE,
    FOREIGN KEY (id_actividad) REFERENCES actividades(id_actividad) ON DELETE CASCADE
);


INSERT INTO usuarios (id_usuario, username, password_hash, nombre_completo, rol) 
VALUES (1, 'alumno33', '1234', 'Ariel Pérez', 'estudiante')
ON DUPLICATE KEY UPDATE nombre_completo='Ariel Pérez';


INSERT INTO cursos (id_curso, nombre_curso) 
VALUES (101, 'INSTALADOR DE FIBERHOME E DESPLEGADOR DE FIBRA...'),
       (102, 'Redes y Telecomunicaciones I'),
       (103, 'Programación Orientada a Objetos')
ON DUPLICATE KEY UPDATE nombre_curso=VALUES(nombre_curso);

INSERT INTO inscripciones (id_usuario, id_curso, progreso) 
VALUES (1, 101, 49),
       (1, 102, 15),
       (1, 103, 95)
ON DUPLICATE KEY UPDATE progreso=VALUES(progreso);

INSERT INTO actividades (id_actividad, id_curso, nombre_actividad, tipo) VALUES
(201, 101, 'CLASE 1', 'seccion'),
(202, 101, 'ACTIVIDAD 1 INSTALADOR', 'actividad'),
(203, 101, 'CLASE 2', 'seccion'),
(204, 101, 'DESPLEGADOR', 'seccion'),
(205, 101, 'Actividad N°2 Desplegador', 'actividad'),
(206, 101, 'Arquitectura FTTH', 'recurso'),
(207, 101, 'video instalador', 'video')
ON DUPLICATE KEY UPDATE nombre_actividad=VALUES(nombre_actividad);


INSERT INTO progreso_actividades (id_usuario, id_actividad, completado)
VALUES (1, 202, TRUE)
ON DUPLICATE KEY UPDATE completado=TRUE;


SELECT 'Base de datos creada y configurada con éxito.' AS 'Estado';
